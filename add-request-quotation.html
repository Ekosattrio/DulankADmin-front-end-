<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="POS - Bootstrap Admin Template">
    <meta name="keywords"
        content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects">
    <meta name="author" content="Dreamguys - Bootstrap Admin Template">
    <meta name="robots" content="noindex, nofollow">
    <title>Dreams Pos Admin Template</title>

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">

    <!-- animation CSS -->
    <link rel="stylesheet" href="assets/css/animate.css">

    <!-- Datatable CSS -->
    <link rel="stylesheet" href="assets/css/dataTables.bootstrap5.min.css">

    <!-- Select2 CSS -->
    <link rel="stylesheet" href="assets/plugins/select2/css/select2.min.css">

    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="assets/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css">

    <!-- Main CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .small {
            font-size: 0.85rem;
        }

        .text-standard {
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <div id="global-loader">
        <div class="loader"> </div>
    </div>
    <!-- Main Wrapper -->
    <div class="main-wrapper">

        <!-- header -->
        <div id="header-placeholder"></div>
        <!-- sidebar -->
        <div id="sidebar-placeholder"></div>

        <div class="page-wrapper">
            <div class="content my-4">
                <div class="page-header">
                    <div class="add-item d-flex">
                        <div class="page-title">
                            <h4>Add New Request For Quotation (RFQ)</h4>
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <div class="shadow p-5" id="detail">

                        <div class="d-flex justify-content-between mb-4">

                            <!-- LOGO -->
                            <div class="d-flex justify-content-center">
                                <div class="border p-4 d-flex align-items-center justify-content-center"
                                    style="height:110px; width: 180px;">
                                    <h5 class="mb-0">Logo</h5>
                                </div>
                            </div>

                            <!-- COMPANY INFO -->
                            <div>
                                <div class="text-standard">
                                    <h2 class="fw-normal d-block" style="font-size:1.5rem;">PT. DULANK SEMESTA
                                        CIDA</h2>
                                    </span>
                                    <span class="small d-block">Jl. Arif Rahman Hakim / Niaga (depan stasiun)
                                        Karawang</span>
                                    <span class="small d-block">Kel. Nagasari Kec.Karawang Barat Kab. Karawang Jawa
                                        Barat</span>
                                    <span class="small d-block">ptdulanksemestacida@gmail.com</span>
                                </div>
                            </div>



                        </div>

                        <div class="row align-items-center my-1">
                            <div class="col-2 small fw-bold">To</div>
                            <div class="col-4 small"><input type="text" class="form-control form-control-sm"
                                    placeholder="To"></div>
                            <div class="col-2 small fw-bold">No. RFQ</div>
                            <div class="col-4 small"><input type="text" class="form-control form-control-sm"
                                    placeholder="No. RFQ"></div>
                        </div>
                        <div class="row align-items-center my-1">
                            <div class="col-2 small fw-bold">Att</div>
                            <div class="col-4 small"><input type="text" class="form-control form-control-sm"
                                    placeholder="Att"></div>
                            <div class="col-2 small fw-bold">Date</div>
                            <div class="col-4 small"><input type="date" class="form-control form-control-sm"
                                    placeholder="Date"></div>
                        </div>
                        <div class="row align-items-center my-1">
                            <div class="col-2 small fw-bold">No. Telp</div>
                            <div class="col-4 small"><input type="text" class="form-control form-control-sm"
                                    placeholder="Telp"></div>
                            <div class="col-2 small fw-bold">Email</div>
                            <div class="col-4 small"><input type="text" class="form-control form-control-sm"
                                    placeholder="Email"></div>
                        </div>

                        <div class="mt-4 text-standard">
                            Yours faithfully,<br>
                            Please provide an offer for the provision of the following goods/services with the best
                            quality, price, and delivery time via fax or email.
                        </div>

                        <div class="mb-3 mt-4">

                            <div class="row my-5">
                                <div class="col-12">
                                    <div>
                                        <div class="table-responsive mb-4">
                                            <table class="table" id="item-table">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 500px;">Description</th>
                                                        <th class="text-end" style="width: 100px;">Quantity</th>
                                                        <th style="width: 150px;">Unit</th>
                                                        <th style="width: 100px;">ETA</th>
                                                        <th style="width: 50px;">Action</th>
                                                    </tr>
                                                </thead>

                                                <tbody id="item-body">
                                                </tbody>
                                            </table>
                                        </div>

                                        <a href="javascript:void(0);" id="btn-add-blank-item" class="text-primary">
                                            <i data-feather="plus-circle" class="plus-down-add"></i>
                                            <span>add New blank</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-3 text-standard">
                            <div class="row my-1">
                                <div class="col-6 fw-bold small">Due Date</div>
                                <div class="col-6 small"><input type="date" class="form-control form-control-sm"
                                        placeholder="Due Date"></div>
                            </div>
                            <div class="row my-1">
                                <div class="col-6 fw-bold small">Payment Term</div>
                                <div class="col-6 small"><input type="text" class="form-control form-control-sm"
                                        placeholder="Payment Term"></div>
                            </div>
                        </div>

                        <div class="mt-4 text-standard">
                            Quotation requested to:<br><br>
                            <div class="col-6">
                                <div>
                                    <div class="mb-4">

                                        <div id="termContainer">

                                            <div class="d-flex py-2 term-item" data-term-id="1">
                                                <span class="fw-bold me-2">Department: </span>
                                                <div class="flex-grow-1 term-content text-start">
                                                    <div contenteditable="true" data-placeholder="Departemen keuangan"
                                                        style="min-height: 38px;">Departemen Kuangan</div>

                                                </div>
                                                <a class="confirm-text p-2 text-danger delete-term-btn"
                                                    href="javascript:void(0);">
                                                    <i data-feather="trash-2"></i>
                                                </a>
                                            </div>
                                            <div class="d-flex py-2 term-item" data-term-id="1">
                                                <span class="fw-bold me-2">Attn: </span>
                                                <div class="flex-grow-1 term-content text-start">
                                                    <div contenteditable="true" data-placeholder="Eko Satrio Handoyo "
                                                        style="min-height: 38px;">Attn Eko Satrio Handoyoo Putro</div>

                                                </div>
                                                <a class="confirm-text p-2 text-danger delete-term-btn"
                                                    href="javascript:void(0);">
                                                    <i data-feather="trash-2"></i>
                                                </a>
                                            </div>
                                            <div class="d-flex py-2 term-item" data-term-id="1">
                                                <span class="fw-bold me-2">Email: </span>
                                                <div class="flex-grow-1 term-content text-start">
                                                    <div contenteditable="true" data-placeholder="Email"
                                                        style="min-height: 38px;">
                                                        EkoSatrio@gmail.com
                                                    </div>

                                                </div>
                                                <a class="confirm-text p-2 text-danger delete-term-btn"
                                                    href="javascript:void(0);">
                                                    <i data-feather="trash-2"></i>
                                                </a>
                                            </div>
                                            <div class="d-flex py-2 term-item" data-term-id="1">
                                                <span class="fw-bold me-2">Telp: </span>
                                                <div class="flex-grow-1 term-content text-start">
                                                    <div contenteditable="true" data-placeholder="Email"
                                                        style="min-height: 38px;">
                                                        +6289716828726
                                                    </div>

                                                </div>
                                                <a class="confirm-text p-2 text-danger delete-term-btn"
                                                    href="javascript:void(0);">
                                                    <i data-feather="trash-2"></i>
                                                </a>
                                            </div>

                                        </div> 
                                        
                                        <a href="javascript:void(0);" id="btnAddNewTerm"
                                            class="mt-3 d-inline-block text-primary">
                                            <i data-feather="plus-circle" class="plus-down-add"></i>
                                            <span>add New blank</span>
                                        </a>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 text-standard">
                            All quotations must include the RFQ number above as a reference.
                            <br>
                            All quotations and procurement of goods must adhere to the terms and conditions of purchase
                            for goods/services of PT. Dulank Semesta Cida. Thank you for your attention and cooperation.
                        </div>

                        <div class="mt-5">
                            Hormat kami,<br><br><br>
                            <b><input type="text" class="input-no-border" placeholder="Name"></b><br>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>

    <template id="blank-item-template">
        <tr class="item-row new-item-row">
            <td class="text-start">
                <div class="product-desc" contenteditable="true" data-placeholder="Enter item description"
                    style="min-height: 38px;"></div>
            </td>
            <td style="width: 150px;" class="text-end">
                <div class="product-quantity" style="width: 100% !important;">
                    <span class="quantity-btn plus-btn">+<i data-feather="plus-circle" class="plus-circle"></i></span>
                    <input type="text" class="quntity-input input-qty" value="0">
                    <span class="quantity-btn minus-btn"><i data-feather="minus-circle"
                            class="feather-search"></i></span>
                </div>
            </td>
            <td style="width: 150px;">
                <select class="form-select form-select-sm input-unit select">
                    <option value="" selected disabled>Select Unit</option>
                    <option value="s-1">Ream</option>
                    <option value="s-5">Pieces</option>
                </select>
            </td>

            <td class="text-end">
                <input type="date" class="form-control form-control-sm ">
            </td>
            <td style="width: 50px;">
                <a href="javascript:void(0);" class="confirm-text p-2 text-danger btn-delete-row">
                    <i data-feather="trash-2"></i>
                </a>
            </td>
        </tr>
    </template>

    <!-- /Main Wrapper -->
    <script src="assets/js/jquery-3.7.1.min.js"></script>


    <!-- Feather Icon JS -->
    <script src="assets/js/feather.min.js"></script>

    <!-- Slimscroll JS -->
    <script src="assets/js/jquery.slimscroll.min.js"></script>

    <!-- Datatable JS -->
    <script src="assets/js/jquery.dataTables.min.js"></script>
    <script src="assets/js/dataTables.bootstrap5.min.js"></script>

    <!-- Bootstrap Core JS -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <!-- Summernote JS -->
    <script src="assets/plugins/summernote/summernote-bs4.min.js"></script>

    <!-- Select2 JS -->
    <script src="assets/plugins/select2/js/select2.min.js"></script>

    <!-- Datetimepicker JS -->
    <script src="assets/js/moment.min.js"></script>
    <script src="assets/js/bootstrap-datetimepicker.min.js"></script>

    <!-- Bootstrap Tagsinput JS -->
    <script src="assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput.js"></script>

    <!-- Sweetalert 2 -->
    <script src="assets/plugins/sweetalert/sweetalert2.all.min.js"></script>
    <script src="assets/plugins/sweetalert/sweetalerts.min.js"></script>

    <!-- Custom JS -->

    <script src="assets/js/theme-script.js"></script>
    <script src="assets/js/script.js"></script>
    <!-- ini script buat add item -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const btnAddBlank = document.getElementById("btn-add-blank-item");
            const tbody = document.getElementById("item-body");
            const template = document.getElementById("blank-item-template");

            // Fungsi untuk menonaktifkan input/select dan tombol QTY pada suatu baris
            function disableRowInputs(row) {
                row.classList.add('disabled-row');
                row.classList.remove('new-item-row');

                // Disable semua input dan select (kecuali yang readonly)
                row.querySelectorAll('input:not([readonly]), select').forEach(element => {
                    element.setAttribute('disabled', 'disabled');
                });

                // Hancurkan Select2 
                row.querySelectorAll('.select.select2-hidden-accessible').forEach(select => {
                    $(select).select2('destroy');
                    select.setAttribute('disabled', 'disabled');
                });
            }

            // Fungsi untuk mengaktifkan kembali input/select pada suatu baris
            function enableRowInputs(row) {
                row.classList.remove('disabled-row');
                row.classList.add('new-item-row');

                // Enable semua input dan select
                row.querySelectorAll('[disabled]').forEach(element => {
                    if (!element.hasAttribute('readonly')) {
                        element.removeAttribute('disabled');
                    }
                });

                // Inisialisasi ulang Select2
                row.querySelectorAll('.select').forEach(select => {
                    $(select).next('.select2-container').remove();
                    $(select).select2({
                        width: '100%',
                    });
                });
            }

            // Setup handlers untuk baris (QTY buttons, calculation, delete)
            function setupRowHandlers(row) {
                const qty = row.querySelector(".input-qty");
                const price = row.querySelector(".input-price");
                const amount = row.querySelector(".input-amount");

                // Fungsi kalkulasi
                function calc() {
                    amount.value = (Number(qty.value || 0) * Number(price.value || 0));
                }

                // Event listener untuk input manual
                qty.addEventListener("input", calc);
                price.addEventListener("input", calc);

                // Kalkulasi awal
                calc();
            }

            // --- INISIALISASI AWAL ---
            // Setup handlers untuk semua baris yang sudah ada di HTML
            tbody.querySelectorAll(".item-row").forEach((row) => {
                console.log('Processing row:', row);
                console.log('Has disabled-row class:', row.classList.contains('disabled-row'));

                // Pastikan tidak ada class disabled-row saat load
                row.classList.remove('disabled-row');

                // Pastikan semua input tidak disabled
                row.querySelectorAll('[disabled]').forEach(element => {
                    console.log('Found disabled element:', element);
                    if (!element.hasAttribute('readonly')) {
                        element.removeAttribute('disabled');
                        console.log('Removed disabled from:', element);
                    }
                });

                // Inisialisasi Select2 jika sudah tersedia dan belum di-init
                const select = row.querySelector('.select');
                if (select) {
                    try {
                        // Cek apakah Select2 sudah loaded
                        if (typeof $.fn.select2 !== 'undefined' && !$(select).hasClass('select2-hidden-accessible')) {
                            console.log('Initializing Select2 for:', select);
                            $(select).select2({
                                width: '100%'
                            });
                        } else if (typeof $.fn.select2 === 'undefined') {
                            console.warn('Select2 library not loaded yet, skipping initialization');
                        }
                    } catch (e) {
                        console.error('Error initializing Select2:', e);
                    }
                }

                setupRowHandlers(row);
                console.log('Row setup complete');
            });

            // --- Event Delegation untuk Plus/Minus/Delete Buttons ---
            // Gunakan event delegation pada tbody agar semua button (lama & baru) langsung berfungsi
            tbody.addEventListener('click', function (e) {
                // Cek apakah yang diklik adalah plus button atau parent-nya
                const plusBtn = e.target.closest('.plus-btn');
                if (plusBtn) {
                    e.preventDefault();
                    e.stopPropagation();

                    const row = plusBtn.closest('tr');
                    // Cek apakah baris sedang disabled
                    if (row.classList.contains('disabled-row')) {
                        return; // Jangan lakukan apa-apa jika disabled
                    }

                    const qtyInput = row.querySelector('.input-qty');
                    const priceInput = row.querySelector('.input-price');
                    const amountInput = row.querySelector('.input-amount');

                    let currentQty = Number(qtyInput.value || 0);
                    qtyInput.value = currentQty + 1;
                    amountInput.value = (Number(qtyInput.value || 0) * Number(priceInput.value || 0));
                    return;
                }

                // Cek apakah yang diklik adalah minus button atau parent-nya
                const minusBtn = e.target.closest('.minus-btn');
                if (minusBtn) {
                    e.preventDefault();
                    e.stopPropagation();

                    const row = minusBtn.closest('tr');
                    // Cek apakah baris sedang disabled
                    if (row.classList.contains('disabled-row')) {
                        return; // Jangan lakukan apa-apa jika disabled
                    }

                    const qtyInput = row.querySelector('.input-qty');
                    const priceInput = row.querySelector('.input-price');
                    const amountInput = row.querySelector('.input-amount');

                    let currentQty = Number(qtyInput.value || 0);
                    if (currentQty > 0) {
                        qtyInput.value = currentQty - 1;
                        amountInput.value = (Number(qtyInput.value || 0) * Number(priceInput.value || 0));
                    }
                    return;
                }

                // Cek apakah yang diklik adalah delete button atau parent-nya
                const deleteBtn = e.target.closest('.btn-delete-row');
                if (deleteBtn) {
                    e.preventDefault();
                    e.stopPropagation();

                    const row = deleteBtn.closest('tr');
                    row.remove();

                    // Setelah baris dihapus, aktifkan kembali baris terakhir yang tersisa
                    const remainingRows = tbody.querySelectorAll('.item-row');
                    if (remainingRows.length > 0) {
                        const lastRow = remainingRows[remainingRows.length - 1];
                        // Hanya enable jika baris terakhir masih disabled
                        if (lastRow.classList.contains('disabled-row')) {
                            enableRowInputs(lastRow);
                        }
                    }

                    if (typeof feather !== 'undefined') {
                        feather.replace();
                    }
                }
            });

            // --- Event Listener untuk Tombol 'add New blank' ---
            btnAddBlank.addEventListener("click", function () {
                // 1. NONAKTIFKAN SEMUA BARIS YANG SUDAH ADA
                tbody.querySelectorAll(".item-row").forEach(row => {
                    disableRowInputs(row);
                });

                // 2. KLONING DAN TAMBAHKAN BARIS BARU
                const templateContent = template.content.cloneNode(true);
                const newRow = templateContent.querySelector('tr');

                // Pastikan baris baru ditandai sebagai aktif
                newRow.classList.add('new-item-row');

                // Tambahkan ke DOM
                tbody.appendChild(newRow);

                // 3. REPLACE FEATHER ICONS
                if (typeof feather !== 'undefined') {
                    feather.replace();
                }

                // 4. SETUP SELECT2 untuk baris baru
                const unitSelect = newRow.querySelector(".select");
                $(unitSelect).select2({
                    width: '100%'
                });

                // 5. Setup calculation handlers untuk baris baru
                setupRowHandlers(newRow);

                // Focus ke input description
                const descInput = newRow.querySelector('.input-desc');
                if (descInput) {
                    descInput.focus();
                }
                // â–¼ Tambahkan ini
                feather.replace();
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const termContainer = document.getElementById('termContainer');
            const addNewTermBtn = document.getElementById('btnAddNewTerm');

            // ===========================
            // AUTO RESIZE UNTUK contenteditable
            // ===========================
            function autoResizeEditable(el) {
                el.style.height = 'auto';
                el.style.height = el.scrollHeight + 'px';
            }

            // ===========================
            // UPDATE NOMOR URUT
            // ===========================
            function updateTermNumbers() {
                const termItems = termContainer.querySelectorAll('.term-item');
                termItems.forEach((item, index) => {
                    const termNumberDiv = item.querySelector('.term-number');
                    if (termNumberDiv) {
                        termNumberDiv.textContent = index + 1;
                    }
                });
            }

            // ===========================
            // BUAT ELEMEN BARU TERM
            // ===========================
            function createNewTermElement(content = '') {
                const newTermItem = document.createElement('div');
                newTermItem.classList.add('d-flex', 'py-2', 'term-item');


                newTermItem.innerHTML = `
            <div class="flex-grow-1 term-content text-start">
                <div class="product-desc"
                     contenteditable="true"
                     data-placeholder="Enter item description"
                     style="
                        min-height: 38px;
                        border:1px solid transparent;
                        border-radius:4px;
                        white-space:pre-wrap;
                        outline:none;
                     "
                >${content ? content : ""}</div>
            </div>

            <a class="confirm-text p-2 text-danger delete-term-btn" href="javascript:void(0);">
                <i data-feather="trash-2"></i>
            </a>
        `;

                return newTermItem;
            }

            // ===========================
            // TAMBAH TERM
            // ===========================
            addNewTermBtn.addEventListener('click', function () {
                const newTerm = createNewTermElement('');
                termContainer.appendChild(newTerm);
                updateTermNumbers();

                const newEditable = newTerm.querySelector('.product-desc');

                // event auto-resize
                newEditable.addEventListener('input', function () {
                    autoResizeEditable(this);
                });

                // pertama kali resize
                autoResizeEditable(newEditable);

                newEditable.focus();

                // replace icons
                if (typeof feather !== 'undefined') {
                    feather.replace();
                }
            });

            // ===========================
            // DELETE TERM (DELEGATION)
            // ===========================
            termContainer.addEventListener('click', function (event) {
                const deleteButton = event.target.closest('.delete-term-btn');

                if (deleteButton) {
                    const termItem = deleteButton.closest('.term-item');
                    if (termItem) {
                        termItem.remove();
                        updateTermNumbers();
                    }

                    if (typeof feather !== 'undefined') {
                        feather.replace();
                    }
                }
            });

            // ===========================
            // INIT PERTAMA KALI
            // ===========================
            termContainer.querySelectorAll('.product-desc').forEach(editable => {

                editable.addEventListener('input', function () {
                    autoResizeEditable(this);
                });

                autoResizeEditable(editable);
            });

            updateTermNumbers();

            if (typeof feather !== 'undefined') {
                feather.replace();
            }

        });
    </script>


</body>